# Progress Log

- Step 1 (Profiles) — 完成时间 2025-09-20T10:23:46Z: 搭建 profile 生成模块、CLI、单测，并通过 `uv run pytest -q`。
- Step 2 (DSO + LinDistFlow) — 完成时间 2025-09-20T10:36:39Z: 构建 IEEE33 网模、导出/加载、线性化灵敏度与校验脚本，新增 CLI 与单测通过。
- Step 3 (TSO DC) — 完成时间 2025-09-20T10:39:20Z: 生成 DC 输电案例、标记边界、求解功率平衡，提供 CLI 与单测通过。
- Step 4 (Coupling) — 完成时间 2025-09-20T10:43:35Z: 编排 TSO-DSO 接口映射、信号交换与残差计算，提供示例脚本与单测通过。
- Step 5 (Time Windows) — 完成时间 2025-09-20T10:45:37Z: 实现 Horizon/滚动窗口工具与 profile 对齐函数，并补充单测通过。
- Step 6 (Pyomo DSO) — 完成时间 2025-09-20T10:48:50Z: 搭建基于 LinDistFlow 的 Pyomo 下层调度模型，支持求解与结果抽取并通过单测（若无求解器仅跳过）。
- Step 7 (Pyomo TSO) — 完成时间 2025-09-20T12:12:46Z: 构建上层 DC Pyomo 模型（边界约束/调节变量），提供求解与结果抽取并通过单测（若无求解器仅跳过）。
- Step 8 (ADMM) — 完成时间 2025-09-20T12:16:05Z: 实现 TSO-DSO 之间的共识 ADMM 框架，支持残差历史记录与收敛判定，并通过单测。
- Step 9 (TI Envelope) — 完成时间 2025-09-20T12:20:00Z: 提供包络创建/更新与违约统计工具，完善协调约束监控并通过单测。
- Step 10 (NMPC Wrapper) — 完成时间 2025-09-20T12:24:38Z: 搭建基于 ADMM 的 NMPC 控制器封装，支持包络更新与残差输出，并补充单测通过。
- Step 11 (Forecast) — 完成时间 2025-09-20T12:27:27Z: 实现基线预测（Naive/SMA）函数，确保无 NaN 且长度正确，补充单测通过。
- Step 12 (Runner) — 完成时间 2025-09-20T12:31:48Z: 构建配置驱动的场景 runner 与 CLI，生成 logs/summary 并通过集成测试。
- Step 13 (Metrics & Viz) — 完成时间 2025-09-20T12:36:32Z: 提供指标计算与可视化工具，覆盖评价函数及图表输出并通过单测。
- Step 14 (Batch) — 完成时间 2025-09-20T12:41:28Z: 扩展多 DSO 批处理工具与 CLI seeds 支持，生成 batch.csv 并通过单测。
 - Integration (Runner + Pyomo) — 完成时间 2025-09-20T12:44:18Z: 将 TSO/DSO Pyomo 模型集成进 sim/runner 的 ADMM 回调，新增 cfg/demo.yaml 支持物理约束下的协同优化演示。
- Step 15 (Testing Sweep) — 完成时间 2025-09-20T12:44:18Z: 汇总新增测试、运行全量 `uv run pytest -q`（GLPK 缺失自动跳过）确认覆盖齐全。
 - Plan (Basic Experiments) — 创建 @plan.md v1：汇总 M1–M4 里程碑、6 个冒烟用例与详细实施步骤；待确认后按清单推进代码完善与配置补充。
 - M1 (Profiles & Forecasts) — 增强 `src/profiles.py` 新增 `make_profiles(...)`（输出 data/loads.csv/pv.csv/temp.csv 与 results/figs 图），在 `src/sim/forecast.py` 实现 `sample_forecast(...)`（AR(1) 多场景、支持相对/加性与非负截断），并新增 `data/scenarios.yaml` 默认误差等级集合。
 - M2 (Network & Sensitivity) — 在 `src/dso/network.py` 新增 `solve_ac` 与 `get_sensitivity(method='lindistflow'|'local')` API；扩展 `scripts/build_dso.py` 产出 `sensitivity_eval.csv` 与误差直方图 `sensitivity_hist.png`，以符合《基本实验》验收要求。
 - M3 (Control & Coordination) — 实现算法开关（B0/B1/B2/B3/OUR），新增 `src/nmpc/greedy.py`（B0），在 `src/coord/ti_env.py` 增加 `compute_bounds_from_scenarios`，在 `src/opt/pyomo_dso.py` 新增 `apply_envelope_pg_bounds`（软/硬包络约束并接入目标函数），`src/sim/runner.py` 集成多场景预测→包络生成→模型施加，支持 OUR（软包络）与 B3（硬包络），并为 demo 配置添加 `algorithm` 字段。
